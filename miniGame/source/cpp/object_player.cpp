//=============================================================================
//
// オブジェクトプレイヤー処理 [object_player.cpp]
// Author : 鶴間俊樹
//
//=============================================================================
#include "object_player.h"
#include "manager.h"
#include "renderer.h"
#include "camera.h"
#include "sound.h"
#include "input.h"
#include "gameScene.h"

#include "wallCylinder.h"
#include "effect.h"
#include "object2D.h"
#include "billboard.h"
#include "item_banana.h"

#include "PresetSetEffect.h"
#include "score_ui.h"
#include "player.h"

//=============================================================================
// マクロ定義
//=============================================================================

//--------------------------------
//当たり判定
//--------------------------------
#define COLLISION_RADIUS (40.0f)		//当たり判定の半径	壁とかに使う

//=============================================================================
// デフォルトコンストラクタ
//=============================================================================
CObjectPlayer::CObjectPlayer() : CObjectModel(CModel::MODELTYPE::OBJ_CAR, false)
{
	SetObjType(OBJTYPE_PLAYER);						//オブジェクトタイプの設定
	SetUpdatePriority(UPDATE_PRIORITY::PLAYER);		//更新順の設定
	SetDrawPriority(DRAW_PRIORITY::CHARA);			//描画順の設定

	m_lastPos = D3DXVECTOR3(0.0f, 0.0f, 0.0f);
	m_destRot = D3DXVECTOR3(0.0f, 0.0f, 0.0f);
	m_move = D3DXVECTOR3(0.0f, 0.0f, 0.0f);

	m_pPlayer = nullptr;
}

//=============================================================================
// デストラクタ
//=============================================================================
CObjectPlayer::~CObjectPlayer()
{
	
}

//=============================================================================
// プレイヤーの生成処理
//=============================================================================
CObjectPlayer* CObjectPlayer::Create(D3DXVECTOR3 pos) {
	CObjectPlayer* pObjectPlayer;
	pObjectPlayer = new CObjectPlayer();
	if (pObjectPlayer == nullptr) return nullptr;

	pObjectPlayer->SetPos(pos);
	pObjectPlayer->Init();

	return pObjectPlayer;
}

//=============================================================================
// プレイヤーの初期化処理
//=============================================================================
HRESULT CObjectPlayer::Init(void) {
	//プレイヤーの初期設定
	CObjectModel::SetRot(D3DXVECTOR3(0.0f, D3DX_PI, 0.0f));
	m_destRot.y =  D3DX_PI;	//奥向き

	//マネージャーの取得
	CManager* pManager = CManager::GetManager();

	CObjectModel::Init();

	D3DXCOLOR col = D3DXCOLOR(0.0f, 0.0f, 0.0f, 1.0f);

	//プレイヤーの生成
	m_pPlayer = CPlayer::Create();


	//プレイヤー番号によって色を変える
	switch (m_pPlayer->GetIndex())
	{
	case 1:
		col = OBJECT_PLAYER_COLOR_1P;
		break;
	case 2:
		col = OBJECT_PLAYER_COLOR_2P;
		break;
	case 3:
		col = OBJECT_PLAYER_COLOR_3P;
		break;
	case 4:
		col = OBJECT_PLAYER_COLOR_4P;
		break;
	default:
		break;
	}

	//モデル取得
	CModel *pModel = GetPtrModel();
	if (pModel!= nullptr)
	{
		//指定したマテリアルの色を設定
		pModel->SetMaterialDiffuse(col, 0);
	}

	return S_OK;
}

//=============================================================================
// プレイヤーの終了処理
//=============================================================================
void CObjectPlayer::Uninit(void) {
	//終了処理
	CObjectModel::Uninit();
}

//=============================================================================
// プレイヤーの更新処理
//=============================================================================
void CObjectPlayer::Update(void) {
	////更新しない設定なら
	//if (!m_pPlayer->GetUpdate())
	//{
	//	return;
	//}

	////マネージャーの取得
	//CManager* pManager = CManager::GetManager();

	//CInput* pInput = nullptr;
	//CSound *pSound = nullptr;
	//CCamera* pCamera = nullptr;
	//CGameScene* pGame = nullptr;

	//if (pManager != nullptr) {
	//	//現在の入力デバイスの取得
	//	pInput = pManager->GetInputCur();
	//	//サウンドの取得
	//	pSound = pManager->GetSound();
	//	//カメラの取得
	//	pCamera = pManager->GetCamera();
	//	//ゲームシーンの取得
	//	pGame = pManager->GetGameScene();
	//}

	////位置情報のポインタの取得
	//D3DXVECTOR3 posObjectPlayer = GetPos();


	////----------------------------
	////カメラの設定
	////----------------------------
	//float fRotCameraY = 0.0f;	//カメラの角度
	//if (pCamera != nullptr) {
	//	fRotCameraY = pCamera->GetRot().y;	//カメラの角度を取得
	//}

	////----------------------------
	////移動の反映
	////----------------------------
	////最後の位置座標の保存
	//m_lastPos = posObjectPlayer;
	////移動
	//posObjectPlayer += m_move;
	////位置設定
	//SetPos(posObjectPlayer);

	////----------------------------
	////モデルの更新
	////----------------------------
	//CObjectModel::Update();
}

//=============================================================================
// プレイヤーの描画処理
//=============================================================================
void CObjectPlayer::Draw(void) {
	
	CObjectModel::Draw();
}

//=============================================================================
// プレイヤーのゲームオーバー時の処理
//=============================================================================
void CObjectPlayer::GameOver(void) {
	
}

//=============================================================================
// プレイヤーの最後の位置座標の取得
//=============================================================================
//D3DXVECTOR3 CObjectPlayer::GetLastPos(void) {
//	return m_lastPos;
//}

//=============================================================================
// プレイヤーの移動量の設定
//=============================================================================
//void CObjectPlayer::SetMove(D3DXVECTOR3 move) { m_move = move; }

//=============================================================================
// プレイヤーの移動量の取得
//=============================================================================
//D3DXVECTOR3 CObjectPlayer::GetMove(void) { return m_move; }

//=============================================================================
// プレイヤーの当たり判定の半径の取得
//=============================================================================
float CObjectPlayer::GetRadius(void) {
	return COLLISION_RADIUS;
}